<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		body,ul,li{
			padding: 0;
			margin: 0;
		}
		li{
			list-style: none;
		}
		.rating{
			width: 160px;
			height: 21px;
			margin: 100px auto;
		}
		.rating_item{
			float: left;
			width: 22px;
			height: 21px;
			background: url(images/starky.png) no-repeat;
			cursor: pointer;
			margin-left: 10px;
		}
	</style>
</head>
<body>
	<ul class="rating" id="rating">
		<li class="rating_item" title="很不好"></li>
		<li class="rating_item" title="不好"></li>
		<li class="rating_item" title="一般"></li>
		<li class="rating_item" title="好"></li>
		<li class="rating_item" title="很好"></li>
	</ul>

<script src="jquery-1.9.1.min.js"></script>
<script>


	var rating = (function(){
		//继承
		var extend = function(subClass,superClass){
			var Parent = function(){}
			Parent.prototype = superClass.prototype;
			subClass.prototype = new Parent();
			subClass.prototype.constructor = subClass;
		}

		//点亮星星
		var Light = function(elem,options){
			this.$elem = $(elem);
			this.$item = this.$elem.find(".rating_item");
			this.opts = options;
			this.add = 1;
		}
		Light.prototype.init = function(){
			this.lightOn(this.opts.num);
			if(!this.opts.readOnly){
				this.bindEvent();
			}
		}
		Light.prototype.lightOn = function(num){
			num = parseInt(num);
			this.$item.each(function(index){
				if(index < num){
					$(this).css("background-image","url(images/starsy.png)")
				}else{
					$(this).css("background-image","url(images/starky.png)")
				}
			})
		}
		Light.prototype.bindEvent = function(e){
			var self = this,
				itemLength = self.$item.length;

			self.$elem.on(self.selectEvent,".rating_item",function(e){
				var num = 0,
					$this = $(this);

				self.select(e,$this);
				num = $(this).index() + self.add;
				self.lightOn(num);

				(typeof self.opts.select === "function")&& self.opts.select.call(self.opts.num,itemLength);
				self.$elem.trigger("select",[self.opts.num,itemLength])
			}).on("click",".rating_item",function(){
				self.opts.num = $(this).index() + self.add;
				(typeof self.opts.chosen === "function")&& self.opts.chosen.call(self.opts.num,itemLength);
				self.$elem.trigger("chosen",[self.opts.num,itemLength])
			}).on("mouseout",function(){
				self.lightOn(self.opts.num);
			});
			Light.prototype.select = function(){
				throw new Error("子类必须重写此方法")
			}
		}
		Light.prototype.unbindEvent = function(){
			this.$elem.off()
		}
		//点亮整颗星星
		var LightEntire = function(elem,options){
			Light.call(this,elem,options);
			this.selectEvent = "mouseover";
		}
		extend(LightEntire,Light);
		LightEntire.prototype.lightOn = function(num){
			Light.prototype.lightOn.call(this,num)
		}
		LightEntire.prototype.select = function(){
			self.add = 1;
		}

		//点亮半颗星星
		var LightHalf = function(elem,options){
			Light.call(this,elem,options);
			this.selectEvent = "mousemove";
		}
		extend(LightHalf,Light)
		LightHalf.prototype.lightOn = function(num){
			var isHalf = parseInt(num) !== num,
				count = parseInt(num);

			Light.prototype.lightOn.call(this,count);

			if(isHalf){
				this.$item.eq(count).css("background-image","url(images/starsk.png)")
			}
		}
		LightHalf.prototype.select = function(e,$this){
			if(e.pageX - $this.offset().left < $this.width()/2){
				this.add =  0.5;
			}else{
				this.add =  1;
			}
		}

		//默认参数
		var defaults = {
			mode:"LightEntire",
			num:0,
			readOnly:false,
			select:function(){},
			chosen:function(){}
		}
		var mode = {
			"LightEntire":LightEntire,
			"LightHalf":LightHalf
		}
		//初始化
		var init = function(elem,option){
			var $elem = $(elem),
				rating = $elem.data("rating"),
				options = $.extend({},defaults,typeof option === "object" && option);
			if(!mode[options.mode]){
				options.mode = "LightEntire"
			}
//			new LightEntire(elem,options).init();
//			new LightHalf(elem,options).init();
//			new mode[options.mode](elem,options).init();
			if(!rating){
				$elem.data("rating",(rating = new mode[options.mode](elem,options)));
				rating.init();
			}
			if(typeof option === "string")rating[option]();
		};

	//jQuery插件封装
		$.fn.extend({
			rating:function(option){
				return this.each(function(){
					init(this,option);
				})
			}
		})

		return {
			init:init
		}
	})();
//jQuery调用

	$("#rating").rating({
		mode:"LightHalf",
		num:2.5,
		chosen:function(){
			rating.init("#rating","unbindEvent")
		}
	})


//普通调用
/*	rating.init("#rating",{
		mode:"LightHalf",
		num:2.5,
		chosen:function(){
			rating.init("#rating","unbindEvent")
		}
//		select:function(num,total){
//			console.log(num + "/" + total)
//		}

	})
 */
//	$("#rating").on("select",function(e,num,total){
//		console.log(num + "/" + total)
//	}).on("chosen",function(e,num,total){
//		console.log(num + "/" + total)
//	})


















	/*var rating = (function(){
		var init = function(elem,num){
			if(!num){num = 0}
			$(".rating").on("mouseover",".rating_item",function(){
				lightOn($(this).index() + 1);
			}).on("click",".rating_item",function(){
				num = $(this).index() + 1;
			}).on("mouseout",function(){
				lightOn(num);
			});
		}
		function lightOn(num){
			$("#rating").find(".rating_item").each(function(index,value){
				if(index < num){
					$(this).css("background-image","url(images/starsy.png)")
				}else{
					$(this).css("background-image","url(images/starky.png)")
				}
			})
		}
		return {
			init:init
		}

	})()*/
</script>
</body>
</html>